<!DOCTYPE html>

<html lang="en">

    <head>

        <meta charset="UTF-8">
        <title>Brotherhood - Ajouter un questionnaire</title>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    </head>

    <body>

        <a href="../../home">Retourner au menu principal</a>
        <h1>Ajouter un questionnaire</h1>

        <p>
            <button onclick="saveSurvey()">Sauvegarder</button>
        </p>

        <script>

            var getUrlParameter = function getUrlParameter(sParam)
            {
                var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i ;

                for(i = 0; i < sURLVariables.length; i++)
                {
                    sParameterName = sURLVariables[i].split('=') ;

                    if(sParameterName[0] === sParam)
                    {
                        return sParameterName[1] === undefined ? true : sParameterName[1] ;
                    }
                }
            } ;

            var surveyId = getUrlParameter('surveyId') ;
            var table = $("#questions") ;

            $.getJSON("./surveys/getQuestionsFromASurvey?surveyId=" + surveyId, function(data)
            {
                $.each(data, function(key, val)
                {
                    var dom = "<tr>" ;

                    $.each(val, function(k, v)
                    {
                        if(k != "surveyId")
                        {
                            if(k != "questionId")
                            {
                                if(k == "description")
                                {
                                    dom += "<td>" + v + "</td>" ;
                                }
                            }

                            else
                            {
                                dom += "<td><input hidden type='text' class='questionId' value='" + v + "'/></td>" ;
                            }
                        }
                    }) ;

                    table.append(dom + "<td><input type='text' class='question' required name='question' placeholder='20.00'/></td></tr>") ;
                }) ;
            }) ;

            function saveSurvey()
            {
                $("#questions > tr").each(function()
                {
                    $this = $(this) ;

                    var question = $this.find("input.questionId") ;

                    $.post("./questions/addQuestion",
                    {
                        questionId: question.val()
                    })
                    .done(function(data)
                    {
                        location.reload(true) ;
                    }) ;
                }) ;
            }

        </script>

    </body>

</html>